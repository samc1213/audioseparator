{% extends "base.html" %}
{% block title %}Index{% endblock %}
{% block content %}
  <audio controls autoplay></audio>
  <script type="text/javascript" src="{{url_for('static', filename='js/recorder.js')}}"> </script>

  <input class="btn btn-default" onclick="startRecording(); setTimeout(stopRecording, 3000)" type="button" value="start recording" />
  <!-- <input onclick="stopRecording()" type="button" value="stop recording and play" /> -->

  <script>
    var onFail = function(e) {
      console.log('Rejected!', e);
    };

    var onSuccess = function(s) {
      var context = new webkitAudioContext();
      var mediaStreamSource = context.createMediaStreamSource(s);
      recorder = new Recorder(mediaStreamSource);
      recorder.record();

      // audio loopback
      // mediaStreamSource.connect(context.destination);
    }

    window.URL = window.URL || window.webkitURL;
    navigator.getUserMedia  = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;

    var recorder;
    var audio = document.querySelector('audio');

    function startRecording() {
      if (navigator.getUserMedia) {
        navigator.getUserMedia({audio: true}, onSuccess, onFail);
      } else {
        console.log('navigator.getUserMedia not present');
      }
    }

    function stopRecording() {
      recorder.stop();
      recorder.exportWAV(function(s) {
        audio.src = window.URL.createObjectURL(s);
        alert('DONE');
      });
    }
  </script>

{% endblock %}
